CREATE TABLE t1 (
id int(10) NOT NULL,
status varchar(1) DEFAULT NULL,
PRIMARY KEY (`id`)
)
PARTITION BY LIST  COLUMNS(`status`)
(
PARTITION `a` VALUES IN ('A'),
PARTITION `b` VALUES IN ('B'),
PARTITION `c` VALUES IN ('C'),
PARTITION `d` DEFAULT);
INSERT INTO t1 VALUES (4, 'A');
INSERT INTO t1 VALUES (6, 'A');
INSERT INTO t1 VALUES (4, 'C');
ERROR 23000: Duplicate entry '4' for key 'PRIMARY'
INSERT INTO t1 VALUES (5, 'C');
UPDATE t1 SET id=4 WHERE id=5;
ERROR 23000: Duplicate entry '4' for key 'PRIMARY'
UPDATE t1 SET id=4 WHERE id=5 AND status='C';
ERROR 23000: Duplicate entry '4' for key 'PRIMARY'
UPDATE t1 SET id=6 WHERE id=4 AND status='A';
ERROR 23000: Duplicate entry '6' for key 'PRIMARY'
select * from t1;
id	status
4	A
6	A
5	C
connect  con1,localhost,root,,test;
connect  con2,localhost,root,,test;
connection con1;
SET DEBUG_SYNC= 'berfore_part_unique_check SIGNAL bpu_hit WAIT_FOR bpu_flushed';
INSERT INTO t1 VALUES(7, 'A');
connection con2;
SET DEBUG_SYNC= 'now WAIT_FOR bpu_hit';
INSERT INTO t1 VALUES(7, 'C');
connection default;
SET DEBUG_SYNC= 'now SIGNAL bpu_flushed';
connection con1;
connection con2;
ERROR 23000: Duplicate entry '7' for key 'PRIMARY'
disconnect con1;
disconnect con2;
connection default;
select * from t1;
id	status
4	A
6	A
7	A
5	C
DROP TABLE t1;
set debug_sync= "RESET";
